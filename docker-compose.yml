services:
  sam3-ros2:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # 必要に応じてバージョンを変更してください
        # 例: Nightlyビルドを使用する場合
        # PYTORCH_VERSION: "2.8.0.dev20251120"
        # PYTORCH_INDEX_URL: "https://download.pytorch.org/whl/nightly/cu126"
        PYTORCH_VERSION: "2.7.0"
        PYTORCH_INDEX_URL: "https://download.pytorch.org/whl/cu126"
    image: sam3-ros2:latest
    container_name: sam3-ros2-dev
    runtime: nvidia
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
      - DISPLAY=${DISPLAY}
      - QT_X11_NO_MITSHM=1
      - ROS_DOMAIN_ID=0
    volumes:
      # SAM3プロジェクトディレクトリをマウント
      - .:/workspace/sam3
      # X11ソケットをマウント（GUIアプリケーション用）
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      # Hugging Faceのキャッシュディレクトリ
      - ~/.cache/huggingface:/root/.cache/huggingface
    network_mode: "host"
    stdin_open: true
    tty: true
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [ gpu ]
    command: /bin/bash
